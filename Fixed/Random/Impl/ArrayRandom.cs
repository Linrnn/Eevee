using System;

namespace Eevee.Fixed
{
    /// <summary>
    /// 依靠数组实现的随机数
    /// </summary>
    public sealed class ArrayRandom : EasyRandom
    {
        private static readonly int[] _pool = { 1059724874, 895476732, 753496908, -1219235235, -1366759575, -325225239, -1368260904, -1065556476, -2041773872, -1612974925, 1290073001, -1181505580, 371862214, 269822078, -1063144820, -276239491, -1034967334, 714754829, -293876468, -788495573, 1235800556, -961819717, -538115679, 1101383089, -34017850, -1039589380, 1648227770, 484322425, -670545843, -1504270908, -1695981368, 1210856424, 575011551, -778473865, -974632597, -427712795, 766995228, -1500499493, 1990722297, -544970978, -2057452200, 1255470366, 498148515, 989221850, -654866178, 1117540928, -1167497409, 1379430484, 806184623, 1518306159, -858672564, 621876326, 1921254453, -605001192, 682479618, -707861172, -1121427072, -1068114864, 645521845, 523389681, 1089333746, -1629867911, -483553749, -1696138035, 330925012, 484777514, -1102148511, -565074439, 2020015407, -1125470923, 160364185, 1060188691, 1203007968, 39390708, 2127090549, -1000408975, -1254282465, 69926889, -1138930407, -1415386330, -1831530998, -694314273, -744293329, -770650963, -525313855, 120819562, -223367895, 130679523, -1034890898, 1003790587, -974072968, 1030584453, -976145030, -399053536, 1367736823, 1834446504, 1615891895, -172638992, 251674677, 1994818583, -1489555779, -524835486, -863900651, -788652296, 1368411034, 17584640, -49990054, 422653129, -883042466, -991359700, -1479118256, -86799821, 1912009560, 2015818468, -333337909, -824931403, -296299880, 2138568126, -1792660217, 478294252, 1620133073, 621814193, 339875746, -25317219, -602233493, -74574013, 455377115, 199233237, 1612009440, -1789329155, -2108356627, 814288718, -1806386868, 16990795, 399913988, -1108502442, 1591687912, 369104617, -1640538451, 928211581, -681431045, 1655845379, -1395932367, -1397152315, -322288424, 846796771, 1795684458, -38769591, 534536210, -1920764961, -1758986998, 1619113459, -594079403, -1562893507, 370942927, -2056092829, -1256534196, 1384216516, 1629273100, -184394100, 375700484, -585606276, -814259961, -503176992, 1852092804, -600313952, 1150395116, -602479735, 488856074, 1095043071, 1122228540, -1116362627, -269678816, 2067387730, -898338372, 709877301, 561578113, 1609336744, -1516683595, 624554685, 469130805, -237998435, 548957844, 577484517, -1646930371, 1860916385, -28198118, -905165387, -401003849, 7103015, -1855407962, -158917170, 1262162264, 1384244957, 1033809735, -1665497369, -343471212, -855891849, 496831348, 1104028192, -1307049252, -1913160708, 1385372634, -980198603, 403215901, 590268668, -1542047170, -389090849, 340225968, 837733529, -1234587098, 1167865987, 1264806000, -1344124351, -2049015358, 706897151, 738349063, 1146235779, -1936420151, 600114388, 172999241, -542658837, -1989059143, 771464181, -1148733635, -517173266, -1056331722, 2003591597, 1352044748, -1384542700, 2104456703, 1874791550, 1315673016, -1890122148, 1223729682, 1298851348, -2764044, 1049823767, 230896280, -104978284, -648385191, -1448348142, 640761260, 359039029, 432218964, 727699279, -1150861805, 495053850, -1048070706, -652259063, 812808016, -680536709, 250568403, 1050933936, -1269436732, 1339862665, 1551199310, 828899652, -160224714, 134213249, 1497023056, -2063211849, -1824762979, -1352761230, 234442594, -1237821656, -2133430923, 1068615441, -684900912, -993926824, 736793967, -447112428, -1564963881, 1194398976, -690847386, -1878038781, -1515291450, 1241058295, 599284383, 1014801835, 1605435775, -311166436, 1560279771, 1801788596, 757441844, -1298476823, -1940344537, -707149099, 1273944355, -1411513493, 368143594, 2085249155, 1606648171, 891039532, -1740965659, -805194247, 2050182498, 2060778144, 1305852313, -505178963, 2075526829, -66884660, -1880710384, 1131943776, 95746193, -245108114, 1772582969, 515775500, 54831592, -1648751616, 884575827, 1469008636, 1309287769, -2127675855, 1727547474, -697022110, 1112469732, -2102724454, 65129341, -2054565111, 893742693, 2100876442, 880689143, 796287947, -1970325982, 706850334, -1867029665, 533852745, 487427619, 1744699337, -2086092046, -845668525, 643861967, 1517831265, 1906641178, -348713343, -495422991, 475786025, 2011842578, 410883558, -470503400, -1754718247, 1932101902, 1819343887, 547521407, 680354759, 709011779, 1074387332, -1010625454, -744921696, 1626005472, -124090474, 1691013880, 1604663, -2116087607, -1437621930, -367376766, 456219062, -1170173546, -1710995594, -688941332, -990890993, -1293760959, -1628345647, -1771913612, -2039358947, 802537854, 1978103479, -1189357371, -1709552723, 387363175, -188005390, -359449326, -1560386951, 360419257, -498292309, -993163417, 442445689, 787183328, -1899957132, 1754475152, 286646751, 311914250, 1587668921, 176961420, 312495500, 1227185569, 450346369, -26662310, -563247755, -1542602233, -2044424456, -817513254, -1531292453, 446351841, 2002652817, 1680474898, -154928438, -412815382, 395696907, 82411751, -1836009981, -190400572, -939689405, 120780648, -944700658, 853947619, 1880825353, -1264848660, 1790947419, 1295562789, 344835429, 229756839, 1239655328, 1220461848, 823941471, -2085667084, -1666266276, 859276119, 429021803, 1288547275, 1990017862, 1807369634, 1706802159, 734631754, -1949053302, 1244555475, -238892193, 368319579, -1807480352, 1660584645, -297956560, -460295728, 421797670, -1634332731, 1026269812, 1044756026, 1494134195, -1553397624, 2085216267, -321083033, 2050968788, -902112327, -239684734, -1102720501, -1431017731, 2017971258, 829222598, -2079641958, -1877933750, -433110813, -435583457, -2095883258, 642207621, -1033218610, 848151212, 1584375388, -817584058, -1765570801, 179219365, -1774128876, -1086766777, -952241444, -639479741, 1333352354, 1002136665, -160540156, 133317267, 2065514003, 1461883734, -961200940, 2075345107, -492075586, 86050359, 884940965, -2120492449, 1601305299, -1916963930, -396563084, -1634005258, 1331326834, 1940948035, -852295453, 867728921, 2064284169, -1113215767, -459728573, -868102102, -524974448, -314927998, -1085457820, -1529172244, 1585076618, 917432471, 1658089234, -1297577267, -502174876, -696639988, 1764003769, 446603338, -385626572, 702821043, -1847225951, -680386082, -813200367, -874874714, 1576279474, 1730368225, 106131320, -950838146, -842409463, -1265724293, 1916332821, 389680290, 1040538037, 1116921814, 603420605, 2105318199, 758932454, -485488027, 445257384, -996251271, 484556421, 713282276, -211938167, -1771600481, -1946665763, 1147364274, -722650314, -524397089, 861831437, -351186575, -413016195, 389855029, 1082198624, -1989575491, -865466614, 911306725, 749530284, 1258199967, -419496448, -611783186, -1747344300, 65489310, 1265253565, -1090634004, 1342795338, -988133033, -238912055, -1514298334, -2014729562, -965799224, 205160858, 27501719, -862854015, 1677731921, 498809961, 69572090, 1724158461, 322026978, 929754500, 1734407557, 901885386, -1721867625, 414981735, -1894457059, 901732931, 1278064364, -1010758540, -430829613, 1582605302, 445472836, 1328648470, -1769133828, 1399778763, -2064049278, 392200320, -1976788685, -1345497244, -18164043, -828838337, -1006167832, 2023788003, 1786512556, -1530972564, 483877027, -1707781308, -727805020, 1611818844, 512335955, -1178871155, -1877660307, -290968435, 87808502, -92276957, -988584588, -909779220, 150345991, 1537967156, -1422513424, 946589328, 377793034, 530402146, 907805565, -718307592, -1605835386, 15615978, 1419719399, -866821073, -1357176465, -1829120797, -2022402955, 1394469772, 1887701064, -1883667880, -473068743, -78573523, 863909207, 1557568040, 394958319, -159892871, 202989275, -1024307344, -1681548374, 1562583302, 2059153527, -1093282766, -2083741810, 1266091499, 386258110, -460870543, 799754423, -1327239177, -178435117, -469214654, -155491121, -1905309639, -1701973134, -1344925217, -1276165619, -1981725141, -883877662, -436607410, 404206956, 755147425, 1781535165, -938201571, -1377754849, -2031774522, -959929638, 1798811476, -2081798308, 106883292, 979207806, -59114368, -1248821786, 298018223, 312759404, -1122945412, 825653819, -1283566722, 391671337, -1725373063, -2139912421, 1316957613, -1440267832, -558864011, -1709433636, 2096599919, -1809482267, 586698387, -1949353607, 1998429371, 1715757619, 135887665, 2080339754, -400246218, -979992660, -827081531, 557342547, 1204860495, 1234560861, -1127206300, -331131599, -591529449, 672700208, 1001505949, -1704950765, -520268415, -224678897, 663400299, -1643342443, -1688839867, -1340827542, -1852371339, 184671572, 1936357074, 629393851, -1332259124, -880156740, -1550582608, -816697928, -2123127171, 1527398185, 771642606, -712963002, -1363945043, -1770378022, -188378985, -227360224, -620838729, -1013570859, 997440835, 1183613051, -939975053, -701207635, -811347268, 1459513245, 1968105175, 2028054965, 205945602, 1546526032, -1743937904, 697434842, 1759501489, 1567376183, 1470411203, 1225163654, 1846601184, -1356386288, 1374017056, 1939512345, -344137583, 628451962, 45535384, -1205298113, -546343989, 1670182152, -195743856, 1465168000, -1474435307, 159142635, 392898155, 72289587, -1905898438, -987327587, -426453925, -1490603000, -1273230614, -348863761, 1887937886, -1851557101, -590469765, 1317442822, -1145219245, 2058903581, -708947672, 1759713934, 911196181, -337535895, -1103392314, -187642815, -210906510, -112469251, 1521662880, 1232767364, 1045000750, 42794474, -1617445818, -1507892875, 837161231, 1172007587, 97373155, -817874914, 274843829, 414254734, -1964871676, 1047460439, -231719540, -1669990497, -155616719, -929940412, 1365901789, -405030405, 1643191469, -1146589830, 1859115112, -1654960752, 1950719502, -1260142661, 1358603807, 11233480, 1558386456, 1728606581, -1459909595, 778966210, -135282206, 665250555, -1153444906, 1840780513, 462786201, 530416594, 2121704947, 2074980659, 1589356981, -1013274420, -1274660527, -506696149, -298032521, -1368051134, -1774700884, -1882025362, 7945010, 75758101, 1664148942, -1337144145, -1420497936, -1077523895, -59690, -1155422987, 664408517, -1073073736, -355567846, 2116421032, 1214231736, 644907295, -60482525, 1657545328, -248137762, 903760942, 389716382, 1453427687, 546421185, -1852326706, 917386766, -64397899, -40357011, -416934196, -1850419691, -1996225794, 1091384242, -332398777, 1465448692, -1347124952, 1724548155, -372306112, -1711342803, -1216506226, -904307000, -449652177, 1844370820, 1017102951, -1599217949, -260888617, 1832975226, 906302037, -613489665, -1988525625, 1353198852, -810671828, -2067044041, 1233133828, -1429494322, -557424774, 1115046763, 358542354, 1684199269, -965050259, -1802976404, 1320282935, 505438855, -1333756737, -1666254493, -600453921, -1502137139, -1246831457, -1269502386, 1602761147, 474213102, -1343495977, -1714565292, 1230319101, -1887674433, -543866062, -360275852, -1200464358, 1503045909, -236144353, 843454003, -2147132538, 845716479, -344885327, -521371277, 1801777388, -749956667, 2049184898, 709884421, -1418273547, -314731049, 1612657995, -1937054973, -1349113979, 525685623, -1109137127, 518985848, -800111130, 259928707, 1798669414, 941858231, 1983945545, 1942486906, 478601009, -1681254168, -1390661804, -1781286331, 2106810249, 978636451, -515155380, 2144893512, -1788586217, 315631855, -6293521, 1469956724, -515992174, 221620854, 540057239, 535089508, -2131680642, -365871639, 183813567, 1748788240, -1254179665, -497898115, 1905690444, 250949177, -1599604033, 19117150, -799837213, -884973773, -1122671541, -1145778533, 1984862688, 190706316, 1682336049, -56386522, 264755245, -1685917231, 269133319, -1850670796, 556804160, -589811752, -664456374, -1072047479, 1944677334, -1428559566, -820313813, 1832218384, -436743771, -1396756160, -549244885, 687908789, -1512507482, -1176497814, 405192967, -416653427, 1070946944, -2096123465, 1260566254, -1173736989, 432000208, 1564772092, -415319994, -1451792091, -775073218, 458659782, 1987977848, -2046504746, -880138889, -1272842510, 125521904, 1411214541, -1878219130, -1610560057, 209859448, -1050837029, -1435744817, -513237484, 881869822, -1114251824, 1614274257, 2028814921, 1075421616, 988264706, -27010040, -1867835480, 1477396332, -38707351, 2127954101, -451400756, -1730413306 };

        private long _index;
        private readonly uint _offset;
        private readonly int[] _array;

        public ArrayRandom(int seed)
        {
            _index = seed;
            _offset = (uint)Math.Abs((long)seed);
            _array = _pool;
        }
        public ArrayRandom(int[] pool)
        {
            _index = 0;
            _offset = 1;
            _array = pool;
        }

        protected override int GetInt(int minInclusive, int maxExclusive)
        {
            int number = GetAndOffset();
            long value = SquashNumber(number, minInclusive, maxExclusive);
            return (int)value;
        }

        private int GetAndOffset()
        {
            int index = GetIndex();
            int value = _array[index];
            _index = index + _offset;
            return value;
        }
        private int GetIndex()
        {
            long dividend = _index; // 被除数
            int divisor = _array.Length; // 除数

            if (dividend >= 0)
                return (int)(dividend % divisor);

            int remainder = (int)(-dividend % divisor); // 余数
            return remainder == 0 ? 0 : divisor - remainder;
        }
        private long SquashNumber(long number, long inputMin, long inputMax, long limitMin = int.MinValue, long limitMax = int.MaxValue) // 压缩数字
        {
            var slope = inputMax - inputMin;
            var suffix = inputMin * limitMax - inputMax * limitMin;
            var numerator = slope * number + suffix;
            var denominator = limitMax - limitMin;
            return numerator / denominator;
        }
    }
}